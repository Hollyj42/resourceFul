<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/courses.css">
    <link rel="stylesheet" href="../css/home.css">
</head>
<body>
    <header>
      <div class="nav">
        <div class="logo"><a href="../html/home.html">RESOURCEFUL</a></div>           
        <ul>
              <li class="about">ABOUT US</li>
              <li class="help">HELP</li>
              <li><a href="../html/login.html"><button class="lgbtn">LOGIN / SIGN UP</button></a></li>
           </ul> 
      </div>
    </header>

     <div class="exploreSection">
        <input type="text" class="courseSearch" placeholder="Course title / No" maxlength="20" autofocus> <br>
        <button class="courseSubmit">Search</button>
    </div>

<div id="materialsContainer" class="material-grid">
    <table>
        <thead>
            <tr class="head">
                <th>Course Name</th>
                <th>Lecturer</th>
                <th>Document Link</th>
            </tr>
        </thead>
        <tbody id="courseTableBody">
            </tbody>
    </table>
</div>

<script>
    function loadCourses() {
        // 1. Fetch data from your backend API route
        fetch('/api/courses')
            .then(response => {
                // Check if the server responded okay (Status 200)
                if (!response.ok) {
                    throw new Error('Server response failed: ' + response.statusText);
                }
                return response.json();
            })
            .then(documents => {
                const tableBody = document.getElementById('courseTableBody');
                tableBody.innerHTML = ''; // Clear any loading/placeholder content

                // 2. Loop through the documents and create a table row for each
                documents.forEach(doc => {
                    const row = tableBody.insertRow();
                    
                    // Column 1: Course Name (doc.course)
                    row.insertCell().textContent = doc.course;
                    
                    // Column 2: Lecturer (doc.lecturer)
                    row.insertCell().textContent = doc.lecturer;
                    
                    // Column 3: The Download Link
                    const downloadCell = row.insertCell();
                    const downloadLink = document.createElement('a');
                    
                    // Set the link text to the document title
                    downloadLink.textContent = doc.title || 'Download File'; 
                    
                    // CRITICAL: The link URL points to your server's download route
                    downloadLink.href = `/download/${doc.filename}`; 
                    
                    // Optional: Helps ensure the browser downloads the file
                    downloadLink.setAttribute('download', doc.filename); 
                    
                    downloadCell.appendChild(downloadLink);
                });
            })
            .catch(error => {
                console.error('Error fetching courses:', error);
                // Display a user-friendly error message
                document.getElementById('courseTableBody').innerHTML = 
                    '<tr><td colspan="3">....</td></tr>';
            });
    }

    // Call the function automatically when the page loads
    window.onload = loadCourses; 
</script>
</body>
</html>